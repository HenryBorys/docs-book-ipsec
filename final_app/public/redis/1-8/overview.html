<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Redis for PCF |
    Pivotal Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
<script type="text/javascript">
  if (window.location.host === 'docs.pivotal.io') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39702075-1']);
    _gaq.push(['_setDomainName', 'pivotal.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0055/2990.js?"+Math.floor(new Date().getTime()/3600000);
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>

<!-- Munchkin Marketo Script -->
<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="redis redis_1-8 redis_1-8_overview has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "pivotal.io";
    </script>

      <header class="global-header header header-layout js-bar-links">
    <a class="pivotal-logo" href="/">
    </a>
    <a href="/" class="global-header-title">
      <span class="title-deemph">Pivotal</span> Documentation
    </a>
    <div class="btn-menu" data-behavior="MenuMobile"></div>
    <div class="header-links">
      <div class="header-item">
        <a href="https://network.pivotal.io/">Downloads</a>
      </div>
      <div class="header-item">
        <a href="http://support.pivotal.io" target="_blank">Support</a>
      </div>

      <div class="header-item embedded-searchbar">
          <form method="get" action="/search">
            <input name="q" placeholder="Search Redis 1.8" class="search-box" />
            <input type="hidden" name="product_name" value="Pivotal Redis" />
              <input type="hidden" name="product_version" value="1.8"/>
          </form>
      </div>
      
    </div>
  </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>


      <li class="has_submenu expanded">
        <a href="/redis/1-8/index.html">About Redis for PCF</a>
        <ul>
          <li>
            <a href="/redis/1-8/minor-overview.html">Overview of Redis for PCF v.1.7</a>
          </li>
          <li>
            <a href="/redis/1-8/release.html">Release Notes</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#config">How Redis for PCF Configures Redis</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#plans">Service Plans</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#architecture">Architecture</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#lifecycle">Lifecycle</a>
          </li>
          <li>
            <a href="/redis/1-8/recommended.html">Recommended Usage and Limitations</a>
          </li>
          <li>
            <a href="/redis/1-8/security.html">Security</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu expanded">
        <a href="/redis/1-8/maintain.html">Operator Guide</a>
        <ul>
          <li>
            <a href="/redis/1-8/installing.html">Installing Redis</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#service-plans">Configuring Service Plans</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#syslog">Configuring Syslog Output</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#backup">Configuring Automated Backups</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#azs">Networks, Security, and Assigning AZs</a>
          </li>          
          <li>
            <a href="/redis/1-8/installing.html#validation">Validating Install with Smoke Tests</a>
          </li>
          <li>
            <a href="/redis/1-8/manual-br.html#create">Creating Manual Backups</a>
          </li>
          <li>
            <a href="/redis/1-8/manual-br.html#restore">Restoring from Backups</a>
          </li>
          <li>
            <a href="/redis/1-8/monitoring.html">Monitoring and Metrics</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#upgrades">Upgrading Redis for PCF</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#uninstall">Uninstalling Redis for PCF</a>
          </li>
          <li>
            <a href="/redis/1-8/troubleshooting.html">Troubleshooting</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu expanded">
        <a href="/redis/1-8/appdevs.html">Application Developer Guide</a>
        <ul>
          <li>
            <a href="/redis/1-8/appdevs.html#getting-started">Getting Started</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#service-plans">Service Plans</a>
          </li>
          <li>
            <a href="/redis/1-8/using.html#create">Creating a Redis Service Instance</a>
          </li>
          <li>
            <a href="/redis/1-8/using.html#bind">Binding an App to a Service Instance</a>
          </li>
          <li>
            <a href="/redis/1-8/using.html#delete">Deleting a Service Instance</a>
          </li>
          <li>
            <a href="/redis/1-8/recommended.html">Recommended Usage and Limitations</a>
          </li>
          <li>
            <a href="/redis/1-8/redisconf.html">Sample Redis Configuration</a>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</div><!--end of sub-nav-->





      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
          <div class="local-header title-container">
    <div class="local-header version-info">
      LATEST VERSION: 1.8 - <a href="">CHANGELOG</a>
    </div>
    <div class="local-header local-title clearfix">
      <img src="/images/cloud_rings.png">
      <span class="local-header-title">Pivotal Redis
      </span>
      <span class="local-header local-version header-dropdown">
        <a class="local-header header-dropdown-link">v1.8</a>
        <span class="local-header header-dropdown-content">
          <ul>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-7/overview.html">v1.7</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-6/overview.html">v1.6</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-5/overview.html">v1.5</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-4/overview.html">v1.4</a>
                </li>
          </ul>
        </span>
      </span>

      <!-- search was here -->
    </div>
    <div class="local-header local-header-links">
    </div>
  </div>

          <h1 class="title-container" >
    Redis for PCF
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#config">Redis Configuration</a></li>
<li>
<a href="#service">Service Plan Descriptions</a><ul>
<li><a href="#shared">Shared-VM Plan</a></li>
<li><a href="#dedicated">Dedicated-VM Plan</a></li>
</ul>
</li>
<li><a href="#high-availability">Highly Available Deployments</a></li>
<li><a href="#resources">Default Resources</a></li>
<li><a href="#security">Security</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <h2><a id ="config"></a>Redis Configuration</h2>

<p>Redis is configured with a maxmemory-policy of no-eviction. This policy means that the once memory is full, the service will not evict any keys and no write operations will be possible until memory becomes available. Persistence is configured for both <code>RDB</code> and <code>AOF</code>. The default maximum number of connections, maxclients, is set at 10000 but this number is adjusted by Redis according to the number of file handles available. Replication and event notification are not configured.  </p>

<h2><a id="service"></a>Service Plan Descriptions</h2>

<ul>
<li><a href="#shared">Shared-VM Plan</a></li>
<li><a href="#dedicated">Dedicated-VM Plan</a></li>
</ul>

<h3><a id="shared"></a>Shared-VM Plan</h3>

<p>An instance of this plan provisions a single Redis process on a single <strong>shared VM</strong> that is suitable for workloads which do not require dedicated hardware.</p>

<p>Data persistence is enabled through the use of <code>RDB</code> and <code>AOF</code>.</p>

<h4>Operator Notes</h4>

<ul>
<li>This plan deploys a shared VM and a single service broker VM.</li>
<li>This plan can be disabled by setting the <code>Max instances limit</code> on the <code>Shared-VM Plan</code> tab in OpsManager to be <code>0</code>.</li>
<li>The maximum number of instances can be increased from the default 5 to a value of your choosing. If you increase the number of instances that can be run on this single VM, you should consider increasing the resources allocated to the VM. In particular RAM and CPU. You can overcommit to a certain extent, but may start to see performance degradations.</li>
<li>You can also increase the maximum amount of RAM allocated to each Redis process (service instance) that is running on this VM</li>
<li>If you decrease the service instance limit, any instances that are running where the count is now greater than the limit are not terminated. They are left to be removed naturally, until the total count drops below the new limit you cannot create any new instances. For example if you had a limit of 10 and all were used and reduced this to 8, the two instances will be left running until you terminate them yourself.</li>
</ul>

<h4>Diagram</h4>

<p><img alt="Shared-VM Diagram" src="images/shared.jpeg" /></p>

<h4>Known Limitations</h4>

<p>Limitations with the current <code>shared-vm</code> plan include:</p>

<ul>
<li>It cannot be scaled beyond a single virtual machine.</li>
<li>The following commands are disabled: <code>CONFIG</code>, <code>MONITOR</code>, <code>SAVE</code>, <code>BGSAVE</code>,
<code>SHUTDOWN</code>, <code>BGREWRITEAOF</code>, <code>SLAVEOF</code>, <code>DEBUG</code>, and <code>SYNC</code>.</li>
<li>Constraining CPU and/or disk usage is not supported.</li>
<li>The Shared-VM plan does not manage &lsquo;noisy neighbor&rsquo; problems so it is not recommended for production apps.</li>
</ul>

<h3><a id="dedicated"></a>Dedicated-VM Plan</h3>

<p>An instance of this plan, provisions a single Redis process, on a single <strong>dedicated VM</strong>, which is suitable for workloads that require isolation or dedicated hardware.</p>

<p>The following commands are enabled:</p>

<ul>
<li><code>MONITOR</code></li>
<li><code>SAVE</code></li>
<li><code>BGSAVE</code></li>
<li><code>BGREWRITEAOF</code></li>
</ul>

<p>Data persistence is enabled through the use of <code>RDB</code> and <code>AOF</code>.</p>

<p>The <code>maxmemory</code> value for the Redis process is set to be 45% of the RAM for that instance.</p>

<p>The persistent disk should be set to be at least the size of the RAM available to the VM or greater, in order to account for the final and temporary RDB file generated by the Redis background save.</p>

<h4>Operator Notes</h4>

<ul>
<li>This plan deploys several dedicated Redis VMs and a single service broker VM.</li>
<li>These instances are pre-provisioned during the deployment of the tile from OpsManager into a <strong>pool</strong>. The VMs are provisioned and configured with a Redis process ready to be used when an instance of the <code>dedicated-vm</code> plan is requested.</li>
<li>A default deployment will provision <code>5 instances</code> of the <code>dedicated-vm</code> plan into the <strong>pool</strong>. This number can be increased on the <code>Resource Config</code> tab in Ops Manager, either in the initial deployment, or subsequently thereafter. The number of VMs <strong>cannot</strong> be decreased once deployed.</li>
<li>When a user provisions an instance, it is marked as in use and taken out of the <strong>pool</strong>.</li>
<li>When a user deprovisions an instance, the instance is cleansed of any data and configuration to restore it to a fresh state and placed back into the pool, ready to be used again.</li>
<li>This plan can be disabled by setting the number of instances of the <code>Dedicated node</code> job in Ops Manager to <code>0</code>.</li>
</ul>

<h4>Diagram</h4>

<p><img alt="Dedicated-VM Diagram" src="images/dedicated.jpeg" /></p>

<h4>Known Limitations</h4>

<p>Limitations with the current <code>dedicated-vm</code> plan include:</p>

<ul>
<li>No ability to change the Redis configuration. The <code>CONFIG</code> command is disabled.</li>
<li>Cannot scale down the number of VMs on the plan once deployed.</li>
</ul>

<h2><a id="high-availability"></a>Highly Available Deployments</h2>

<p>Redis for PCF 1.5 does not support configuring multiple availability zones or subnets.</p>

<h2><a id="resources"></a>Default Resources</h2>

<h3>Resource requirements for Redis for PCF</h3>

<p>These are the default resource and IP requirements for installing the tile
<table border="1" class="nice">
    <tr>
        <th>Product</th>
        <th>Resource</th>
        <th>Instances</th>
        <th>CPU</th>
        <th>Ram</th>
        <th>Ephemeral</th>
        <th>Persistent</th>
        <th>Static IP</th>
        <th>Dynamic IP</th>
    </tr>
    <tr>
        <td>Redis</td>
        <td>Redis Broker</td>
        <td>1</td>
        <td>2</td>
        <td>3072</td>
        <td>4096</td>
        <td>9216</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr>
        <td>Redis</td>
        <td>Dedicated Node</td>
        <td>5</td>
        <td>2</td>
        <td>1024</td>
        <td>4096</td>
        <td>4096</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr>
        <td>Redis</td>
        <td>Broker Registrar</td>
        <td>1</td>
        <td>1</td>
        <td>1024</td>
        <td>2048</td>
        <td>0</td>
        <td>0</td>
        <td>1</td>
    </tr>
    <tr>
        <td>Redis</td>
        <td>Broker De-Registrar</td>
        <td>1</td>
        <td>1</td>
        <td>1024</td>
        <td>2048</td>
        <td>0</td>
        <td>0</td>
        <td>1</td>
    </tr>
    <tr>
        <td>Redis</td>
        <td>Compliation</td>
        <td>2</td>
        <td>2</td>
        <td>1024</td>
        <td>4096</td>
        <td>0</td>
        <td>0</td>
        <td>1</td>
    </tr>
</table></p>

<h4>Notes:</h4>

<ul>
<li>The <code>shared-vm</code> plan is on the <code>Redis Broker</code> resource</li>
<li>The <code>dedicated-vm</code> plan is on the <code>Dedicated Node</code> resource</li>
</ul>

<h2><a id="security"></a>Security</h2>

<p>It is recommended that each service run in its own network.</p>

<p>The following ports and ranges are used in this service:</p>

<ul>
<li>Destination port 80 access to the service broker from the cloud controllers</li>
<li>Destination port 6379 access to all dedicated nodes from the Diego Cell and Diego Brain network(s)</li>
<li>Destination ports 32768 to 61000 on the service broker from the Diego Cell and Diego Brain network(s). This is only required for the shared service plan.</li>
<li>Outbound access to your chosen blobstore, typically HTTP 80 or HTTPS 443</li>
</ul>

<h3>Application Security Groups</h3>

<p>To allow this service to have network access you must create <a href="http://docs.pivotal.io/pivotalcf/1-7/adminguide/app-sec-groups.html">Application Security Groups (ASGs)</a>. Ensure your security group allows access to the Redis Service Broker VM and Dedicated VMs configured in your deployment. You can obtain the IP addresses for these VMs in Ops Manager under the <strong>Resource Config</strong> section for the Redis tile.</p></p>

<p class="note"><strong>Note</strong>: Without ASGs, this service will not be usable.</p>

<h4>Application Container Network Connections</h4>

<p>Application containers that use instances of the Redis service require the following outbound network connections:</p>

<table><thead>
<tr>
<th>Destination</th>
<th>Ports</th>
<th>Protocol</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>ASSIGNED_NETWORK</code></td>
<td>32768-61000</td>
<td>tcp</td>
<td>Enable application to access shared vm service instance</td>
</tr>
<tr>
<td><code>ASSIGNED_NETWORK</code></td>
<td>6379</td>
<td>tcp</td>
<td>Enable application to access dedicated vm service instance</td>
</tr>
</tbody></table>

<p>Create an ASG called <code>redis-app-containers</code> with the above configuration and bind it to the appropriate space or, to give all started apps access, bind to the <code>default-running</code> ASG set and restart your apps. Example:</p>
<pre class="highlight plaintext"><code>[
  {
    "protocol": "tcp",
    "destination": "&lt;code&gt;ASSIGNED_NETWORK&lt;/code&gt;",
    "ports": "6379"
  }
]
</code></pre>

        <div><a id='repo-link' href='http://github.com/pivotal-cf/docs-redis/tree/1.8/overview.html.md.erb'>View the source for this page in GitHub</a></div>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='http://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='http://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='http://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="http://support.pivotal.io" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
