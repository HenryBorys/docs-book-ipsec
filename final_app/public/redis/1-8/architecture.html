<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Redis for PCF 1.8 Architecture and Lifecycle |
    Pivotal Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
<script type="text/javascript">
  if (window.location.host === 'docs.pivotal.io') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39702075-1']);
    _gaq.push(['_setDomainName', 'pivotal.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0055/2990.js?"+Math.floor(new Date().getTime()/3600000);
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>

<!-- Munchkin Marketo Script -->
<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="redis redis_1-8 redis_1-8_architecture has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "pivotal.io";
    </script>

      <header class="global-header header header-layout js-bar-links">
    <a class="pivotal-logo" href="/">
    </a>
    <a href="/" class="global-header-title">
      <span class="title-deemph">Pivotal</span> Documentation
    </a>
    <div class="btn-menu" data-behavior="MenuMobile"></div>
    <div class="header-links">
      <div class="header-item">
        <a href="https://network.pivotal.io/">Downloads</a>
      </div>
      <div class="header-item">
        <a href="http://support.pivotal.io" target="_blank">Support</a>
      </div>

      <div class="header-item embedded-searchbar">
          <form method="get" action="/search">
            <input name="q" placeholder="Search Redis 1.8" class="search-box" />
            <input type="hidden" name="product_name" value="Pivotal Redis" />
              <input type="hidden" name="product_version" value="1.8"/>
          </form>
      </div>
      
    </div>
  </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>


      <li class="has_submenu expanded">
        <a href="/redis/1-8/index.html">About Redis for PCF</a>
        <ul>
          <li>
            <a href="/redis/1-8/minor-overview.html">Overview of Redis for PCF v.1.7</a>
          </li>
          <li>
            <a href="/redis/1-8/release.html">Release Notes</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#config">How Redis for PCF Configures Redis</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#plans">Service Plans</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#architecture">Architecture</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#lifecycle">Lifecycle</a>
          </li>
          <li>
            <a href="/redis/1-8/recommended.html">Recommended Usage and Limitations</a>
          </li>
          <li>
            <a href="/redis/1-8/security.html">Security</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu expanded">
        <a href="/redis/1-8/maintain.html">Operator Guide</a>
        <ul>
          <li>
            <a href="/redis/1-8/installing.html">Installing Redis</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#service-plans">Configuring Service Plans</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#syslog">Configuring Syslog Output</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#backup">Configuring Automated Backups</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#azs">Networks, Security, and Assigning AZs</a>
          </li>          
          <li>
            <a href="/redis/1-8/installing.html#validation">Validating Install with Smoke Tests</a>
          </li>
          <li>
            <a href="/redis/1-8/manual-br.html#create">Creating Manual Backups</a>
          </li>
          <li>
            <a href="/redis/1-8/manual-br.html#restore">Restoring from Backups</a>
          </li>
          <li>
            <a href="/redis/1-8/monitoring.html">Monitoring and Metrics</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#upgrades">Upgrading Redis for PCF</a>
          </li>
          <li>
            <a href="/redis/1-8/installing.html#uninstall">Uninstalling Redis for PCF</a>
          </li>
          <li>
            <a href="/redis/1-8/troubleshooting.html">Troubleshooting</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu expanded">
        <a href="/redis/1-8/appdevs.html">Application Developer Guide</a>
        <ul>
          <li>
            <a href="/redis/1-8/appdevs.html#getting-started">Getting Started</a>
          </li>
          <li>
            <a href="/redis/1-8/architecture.html#service-plans">Service Plans</a>
          </li>
          <li>
            <a href="/redis/1-8/using.html#create">Creating a Redis Service Instance</a>
          </li>
          <li>
            <a href="/redis/1-8/using.html#bind">Binding an App to a Service Instance</a>
          </li>
          <li>
            <a href="/redis/1-8/using.html#delete">Deleting a Service Instance</a>
          </li>
          <li>
            <a href="/redis/1-8/recommended.html">Recommended Usage and Limitations</a>
          </li>
          <li>
            <a href="/redis/1-8/redisconf.html">Sample Redis Configuration</a>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</div><!--end of sub-nav-->





      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
          <div class="local-header title-container">
    <div class="local-header version-info">
      LATEST VERSION: 1.8 - <a href="">CHANGELOG</a>
    </div>
    <div class="local-header local-title clearfix">
      <img src="/images/cloud_rings.png">
      <span class="local-header-title">Pivotal Redis
      </span>
      <span class="local-header local-version header-dropdown">
        <a class="local-header header-dropdown-link">v1.8</a>
        <span class="local-header header-dropdown-content">
          <ul>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-7/architecture.html">v1.7</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-6/architecture.html">v1.6</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-5/architecture.html">v1.5</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/redis/1-4/architecture.html">v1.4</a>
                </li>
          </ul>
        </span>
      </span>

      <!-- search was here -->
    </div>
    <div class="local-header local-header-links">
    </div>
  </div>

          <h1 class="title-container" >
    Redis for PCF 1.8 Architecture and Lifecycle
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#config">How Redis for PCF Configures Redis</a></li>
<li><a href="#plans">Service Plans</a></li>
<li><a href="#architecture">Redis for PCF Architecture</a></li>
<li><a href="#lifecycle">Redis for PCF Lifecycle</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <h2><a id ="config"></a>How Redis for PCF Configures Redis</h2>

<p>For On-Demand VMs, certain Redis configurations can be set by the operator during plan configuration,
 and by the app developer during instance provisioning. Other Redis configurations cannot be changed from the default.</p>

<ul>
<li>Operator configurable Redis settings include: <code>timeout</code>, <code>tcp-keepalive</code>, <code>maxclients</code> and <code>lua scripting</code>. Please see the Operator guide for more detail.</li>
<li>App-Developer configurable Redis settings include: <code>maxmemory-policy</code>, <code>notify-keyspace-events</code>, <code>lua-time-limit</code>,<code>slowlog-log-slower-than</code>,<code>slowlog-max-len</code>. Please see the App Developer guide for more detail.</li>
</ul>

<p>For Dedicated-VM and Shared-VM plans, the default Redis configurations cannot be changed.
A sample <code>redis.conf</code> from a Dedicated-VM plan instance can be viewed on <a href="/redis/1-8/redisconf.html">Sample Redis Configuration</a></p>

<ul>
<li><p>Redis is configured with a <code>maxmemory-policy</code> of no-eviction. This policy means that when the memory is full, the service does
not evict any keys or perform any write operations until memory becomes available.</p></li>
<li><p>Persistence is configured for both <code>RDB</code> and <code>AOF</code>.</p></li>
<li><p>The default maximum number of connections, <code>maxclients</code>, is set at 10000 but
this number is adjusted by Redis according to the number of file handles available.</p></li>
<li><p>Replication and event notification are not configured.</p></li>
</ul>

<h2><a id="plans"></a>Service Plans</h2>

<p>Redis for PCF offers On-Demand, Dedicated-VM and Shared-VM plans.</p>

<h3>On-Demand Plans</h3>

<ul>
<li>These plans are operator-configured and enabled. Once enabled, app developers can provision a Redis instance from that plan.</li>
<li>You can disable any of the three on-demand plans in the plan&rsquo;s page in OpsManager.</li>
<li>The maximum number of instances is managed at by a per-plan and global quota. The maximum number of instances cannot surpass 50.</li>
<li>Operators can update the plan settings, including the VM size, disk size and Redis configuration settings, after the plans have been created. <strong>Operators should not downsize the VMs or disk size as this can cause data loss in pre-existing instances.</strong></li>
<li>App Developers can update certain Redis configurations.</li>
</ul>

<h3>Shared-VM Plan</h3>

<ul>
<li>This plan deploys a Redis instance inside the service broker VM.</li>
<li>You can disable this plan by setting the <code>Max instances limit</code> on the <code>Shared-VM plan</code> tab in OpsManager to be <code>0</code>.</li>
<li>The maximum number of instances can be increased from the default 5 to a value of your choosing. If you increase the number of instances that can be run on this single VM, you should consider increasing the resources allocated to the VM. In particular RAM and CPU. You can overcommit to a certain extent, but may start to see performance degradations.</li>
<li>You can also increase the maximum amount of RAM allocated to each Redis process (service instance) that is running on this VM</li>
<li>If you decrease the service instance limit, any instances that are running where the count is now greater than the limit are not terminated. They are left to be removed naturally, until the total count drops below the new limit you cannot create any new instances. For example if you had a limit of 10 and all were used and reduced this to 8, the two instances will be left running until you terminate them yourself.</li>
</ul>

<h3>Dedicated-VM Plan</h3>

<ul>
<li>This plan deploys the operator-configured number of dedicated Redis VMs alongside the service broker VM.</li>
<li>These instances are pre-provisioned during the deployment of the tile from OpsManager into a <strong>pool</strong>. The VMs are provisioned and configured with a Redis process ready to be used when an instance of the Dedicated-VM plan is requested.</li>
<li>A default deployment will provision <code>5 instances</code> of the Dedicated-VM plan into the <strong>pool</strong>. This number can be increased on the <code>Resource Config</code> tab in Ops Manager, either in the initial deployment, or subsequently thereafter. The number of VMs <strong>cannot</strong> be decreased once deployed.</li>
<li>When a user provisions an instance, it is marked as in use and taken out of the <strong>pool</strong>.</li>
<li>When a user deprovisions an instance, the instance is cleansed of any data and configuration to restore it to a fresh state and placed back into the pool, ready to be used again.</li>
<li>You can disable this plan by setting the number of instances of the <code>Dedicated node</code> job in Ops Manager to <code>0</code>.</li>
</ul>

<h2><a id ="architecture"></a>Redis for PCF Architecture</h2>

<p>This diagram shows how the architecture of the service broker and Shared-VM and Dedicated-VM plans and how the user&rsquo;s app binds to a Redis instance.</p>

<p><img alt="Architecture Diagram" src="images/redis-architecture.png" /></p>

<h2><a id ="lifecycle"></a>Redis for PCF Lifecycle</h2>

<p>Here is the lifecycle of Redis for PCF, from an operator installing the tile through an app developer using the service then an operator deleting the tile.</p>

<p><img alt="Lifecycle Diagram" src="images/redis-timeline.png" /></p>

        <div><a id='repo-link' href='http://github.com/pivotal-cf/docs-redis/tree/1.8/architecture.html.md.erb'>View the source for this page in GitHub</a></div>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='http://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='http://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='http://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="http://support.pivotal.io" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
